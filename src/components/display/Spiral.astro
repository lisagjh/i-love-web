<script>
  import p5 from "p5";

  const mySketch = (p) => {
    const elementsX = 9;
    const elementsY = 71;
    const charset = "∙··•˚̊*⁰";
    let containerHeight;
    const rotationSpeed = 0.2; // Adjust this value to change speed (lower = slower, higher = faster)

    p.setup = () => {
      const header = document.querySelector("header");
      containerHeight = header ? header.offsetHeight : window.innerHeight;
      p.createCanvas(window.innerWidth, containerHeight);
    };

    const updateCanvasSize = () => {
      const header = document.querySelector("header");
      containerHeight = header ? header.offsetHeight : window.innerHeight;
      p.resizeCanvas(window.innerWidth, containerHeight);
    };

    p.windowResized = () => {
      updateCanvasSize();
    };

    const setupResizeObserver = () => {
      const header = document.querySelector("header");
      if (header) {
        const resizeObserver = new ResizeObserver(() => {
          updateCanvasSize();
        });
        resizeObserver.observe(header);
      }
    };

    p.draw = () => {
      p.background(255);
      p.fill(0);
      p.noStroke();

      p.textAlign(p.CENTER, p.CENTER);
      p.textSize((containerHeight / elementsY) * 2);

      for (let y = 0; y < elementsY + 1; y++) {
        for (let x = 0; x < charset.length + 1; x++) {
          let posY = p.map(y, 0, elementsY, 0, containerHeight);

          let magX = p.map(
            p.sin(p.radians(posY * 20 + p.frameCount * rotationSpeed)), // Added rotationSpeed here
            -1,
            1,
            -p.width * 0.4,
            200
          );
          let posX = p.map(x, 0, elementsX, -magX, magX);

          let selector = x;

          p.push();
          p.translate(p.width / 2 + posX, posY);
          p.text(charset[selector], 0, 0);
          p.pop();
        }
      }
    };

    setTimeout(() => {
      setupResizeObserver();
    }, 0);
  };

  document.addEventListener("DOMContentLoaded", () => {
    const container = document.getElementById("sketch-container");
    if (container) {
      new p5(mySketch, container);
    }
  });
</script>

<div id="sketch-container"></div>

<style>
  #sketch-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
  }
</style>
